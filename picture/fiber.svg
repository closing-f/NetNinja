<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="412px" height="464px" viewBox="-0.5 -0.5 412 464" content="&lt;mxfile host=&quot;Electron&quot; modified=&quot;2023-09-05T16:03:23.366Z&quot; agent=&quot;5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) draw.io/14.6.13 Chrome/89.0.4389.128 Electron/12.0.7 Safari/537.36&quot; etag=&quot;V4G8EMJZ_3mVC3r8jQ_C&quot; version=&quot;14.6.13&quot; type=&quot;device&quot;&gt;&lt;diagram id=&quot;j39BeKSZk83gd--y38wb&quot; name=&quot;第 1 页&quot;&gt;7VhZb9s4EP41BJoCWeiwZelRkuW2QLLtJgE22xdDkWmbKC0aEp2jD/vbd4akJOuw46TrhwUWMGxyOOLc841M3Hjz/KlIt+trsaCcONbimbhT4jiuY9nwg5QXTbHtyUhTVgVbGFpDuGU/qSFahrpjC1q2GKUQXLJtm5iJPKeZbNHSohBPbbal4G2p23RFe4TbLOV96p9sIdea6juThv6ZstW6kmx7gT7ZpBWzsaRcpwvxtEdyE+LGhRBSrzbPMeXovcov+rnZgdNasYLm8pQH1uPi+/19srxP/yi/x1dyFi+2l+aWx5TvjMEz9kALo7F8qdxQPrENT3PYRUuRy1tzYsM+5WyVwzoDPeBJN3qkhWTgwdAcSLEFarZmfHGVvogdalvKNPtR7aK1KNhPuDbl5k44LqRJBsdrcdzik0C2gFrQEni+VS6wO6Tr9LnFeJWW0hAywXm6LdlDbcYmLVYsj4SUYmOY+h6u3AUW0uc9kvH4Jyo2VBYvwGJOLydVIpsCGJvtU5NMo4plvZdII88QU5PAq/ruJsawMGF+Q8idXsgv9SOQP24I3zuWS280l0gASfBJxsSfEh8WExL6xI+Q2yOOa6ObLlWqQFTQx61bXOfoLSTxSTQjgYWL0CZ+TBKPhBbxfWQORySc4CKy8Km2wEw+N6Kg+CEe8hVhIxLBIqwWEQoLPOJPhmypL38UbPHxvUZ4uAUBSUACBykdIx5qMctdnkkmcuDgWBIo9sMF7FZSZeKb5I9RZjRVBir3NWKJg5dBEckmVDTfbcgE6V9+/3IHP5+/XkFeWMl9EivJzdOxg6ad7fsuubkGiTdJOP1LKRAn3+7IZHrU/gkGNfKUt8Htdsvaepll2thyvsQON8/ELpe1C1KoepZVzm8qoOf+CQkiEiZKjwBVGVBI6RFFQ+7PsrlcFzRdzLmAFlnLl1qreq+68MeW3CjEOHfSOZwqlULij1SlTEngHtPtFE0MeUAhXLrhVhZ7iik10Ni+rA6GYImq3l6IHzQWXMB901xoUGGcd0gVrnC6lAdRpdymGctXV4pnOmooN6aVIknAs0uusHfNFguaIyIIKIFUt390x1ZAzFWrHUfwAfNi67cxGYPiMeztZg8fZC9kLHKwJWUKHChgyxMt5SBsHIXe17HEQAfG7hTosL3RmaDD7UFHL8icqeDpIFcTk/2uCG8gVpw2Ib3DiE8v7V7Y3X7Y3YEQ8/SB8m+iZKrPutNC83ZC/1p02+nL8jUt2DmjbgcnTgz+mYI+GpwXVD9AgKobATS7CTZybAQz4juKkqjGFGBDNEdtYEpmJIoVZkEXG5FA3QM4iXB2pLN04EwrcxxCEWtjnFDUlKAwfq4HlvgBXihwjCjpHNKP0+JC3VzjDcj0lBHjqql6uMYRBfqt3xjxC0A5YL++3jrB/r/70TjsPK1tEN5Sebdm5Yd8xzm09AujiGM1iyMqVLcovygExpiC1GTIZXsQ1fHdIFZrq2Bop/LVqO4brUdF7wAmB2qcPDwkGUuUukBHkNdeDDF3hvQstaKl8WQN2go6BxXrwzgc2VgeKN1Foq4fTCutz6yaDVD1RDnYqGUQuqvOJ6POngLNgIHWxugLFGNhDJsS1IOkihIMOYGO5NiMVkGAqgMPaKm91hltTUYokyBlQs8kQhBUC21tpO55LT9/rZrO/d2EokoVRe/OTodzu3xKt1/yDweS99UxzpTYRIUB5DuGEllDrwNHB+QIVfm6k2fRRWWCn5icHngRwX57quSh2jkouV/vfS/EVTT7zLCYkXA81CXqXmaq8DRVO0+dgmoPAFFn8U0vKk0LGHJb19x93xwo3eFW4hv//aJv2v1OhfAa5rQZAEXHXe8BgSOuGGOhmyPflNgbzDzFusakWE0i/wnDFN1X6QhH4RD+/v8u+G+/FfinvRU4nvPm9wLYNn9Lq7O9f/fd5B8=&lt;/diagram&gt;&lt;/mxfile&gt;" style="background-color: rgb(255, 255, 255);"><defs><clipPath id="mx-clip-4-31-402-164-0"><rect x="4" y="31" width="402" height="164"/></clipPath><clipPath id="mx-clip-4-203-402-262-0"><rect x="4" y="203" width="402" height="262"/></clipPath></defs><g><path d="M 0 26 L 0 0 L 410 0 L 410 26" fill="#ffffff" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><path d="M 0 26 L 0 460 L 410 460 L 410 26" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 0 26 L 410 26" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><g fill="#000000" font-family="Helvetica" font-weight="bold" pointer-events="none" text-anchor="middle" font-size="12px"><text x="204.5" y="17.5">Fiber</text></g><g fill="#000000" font-family="Helvetica" pointer-events="none" clip-path="url(#mx-clip-4-31-402-164-0)" font-size="12px"><text x="5.5" y="43.5">- id : uint64_t //协程id</text><text x="5.5" y="57.5">- stacksize : uint32_t //协程运行栈大小</text><text x="5.5" y="71.5">- ctx : ucontext_t //协程上下文</text><text x="5.5" y="85.5">- stack : void* //协程运行栈指针</text><text x="5.5" y="99.5">- cb : function&lt;void()&gt; //协程运行函数</text><text x="5.5" y="113.5">+ State : enum{ INIT HOLD EXEC </text><text x="5.5" y="127.5">                TERM READY EXCEPT} //协程状态</text><text x="5.5" y="155.5">cc: s_fiber_count : atomic&lt;uint64_t&gt; //目前协程总数</text><text x="5.5" y="169.5">cc_thread_local : t_fiber : Fiber* //线程中的当前协程</text><text x="5.5" y="183.5">cc_thread_local : t_thread_fiber : Fiber::ptr //主协程</text></g><path d="M 0 194 L 410 194" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><g fill="#000000" font-family="Helvetica" pointer-events="none" clip-path="url(#mx-clip-4-203-402-262-0)" font-size="12px"><text x="5.5" y="215.5">- Fiber() //无参构造函数，生成主协程</text><text x="5.5" y="229.5">+ Fiber(function&lt;void()&gt;cb,size_t stack_size,bool use_caller);//分配内存，</text><text x="5.5" y="243.5">        生成子协程</text><text x="5.5" y="257.5">+ ~Fiber() //主协程：SetThis(nullptr)    子协程：释放分配的内存</text><text x="5.5" y="285.5">+ reset(function&lt;void()&gt;cb) //将协程执行函数重置为cb</text><text x="5.5" y="313.5">s+ setThis(Fiber* fiber) //将线程局部变量t_fiber设为fiber</text><text x="5.5" y="327.5">s+ GetThis() // t_fiber有值，返回其智能指针；否则创建主协程，</text><text x="5.5" y="341.5">                        设置 t_thread_fiber</text><text x="5.5" y="369.5">+ swapIn() //将当前协程切换到运行状态</text><text x="5.5" y="383.5">+swapOut() //将当前协程切换到后台</text><text x="5.5" y="397.5">+ call() //将当前线程切换到执行状态, 执行该函数的为当前线程的主协程</text><text x="5.5" y="411.5">+ back() //将当前线程切换到后台，执行的为该协程，返回到线程的主协程</text><text x="5.5" y="439.5">s+ MainFunc() //协程执行函数，执行完成返回到线程主协程</text><text x="5.5" y="453.5">s+ CallerMainFunc() //协程执行函数，执行完成返回到线程调度协程</text></g></g></svg>